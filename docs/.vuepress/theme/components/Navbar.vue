
<template>
  <header class="navbar">
    <div class="navbar-wrapper">
      <a
        href="/"
        class="home-link"
        aria-label="Handsontable Main Page"
      >
        <Logo />
        <span class="dev-badge" v-if="isDev">
          <svg width="90" height="20" viewBox="0 0 90 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="90" height="20" rx="4" fill="#37BC6C"/>
            <path d="M10.6667 7.33332L8 9.99999L10.6667 12.6667M17.3333 7.33332L20 9.99999L17.3333 12.6667M15.3333 4.66666L12.6667 15.3333" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M29.75 14H27.0568V5.27273H29.8693C30.7159 5.27273 31.4403 5.44744 32.0426 5.79688C32.6449 6.14347 33.1065 6.64205 33.4276 7.29261C33.7486 7.94034 33.9091 8.71591 33.9091 9.61932C33.9091 10.5284 33.7472 11.3111 33.4233 11.9673C33.0994 12.6207 32.6278 13.1236 32.0085 13.4759C31.3892 13.8253 30.6364 14 29.75 14ZM28.1136 13.0625H29.6818C30.4034 13.0625 31.0014 12.9233 31.4759 12.6449C31.9503 12.3665 32.304 11.9702 32.5369 11.456C32.7699 10.9418 32.8864 10.3295 32.8864 9.61932C32.8864 8.91477 32.7713 8.30824 32.5412 7.79972C32.3111 7.28835 31.9673 6.89631 31.5099 6.62358C31.0526 6.34801 30.483 6.21023 29.8011 6.21023H28.1136V13.0625ZM38.2898 14.1364C37.6591 14.1364 37.1151 13.9972 36.6577 13.7188C36.2031 13.4375 35.8523 13.0455 35.6051 12.5426C35.3608 12.0369 35.2386 11.4489 35.2386 10.7784C35.2386 10.108 35.3608 9.51705 35.6051 9.00568C35.8523 8.49148 36.196 8.09091 36.6364 7.80398C37.0795 7.5142 37.5966 7.36932 38.1875 7.36932C38.5284 7.36932 38.8651 7.42614 39.1974 7.53977C39.5298 7.65341 39.8324 7.83807 40.1051 8.09375C40.3778 8.34659 40.5952 8.68182 40.7571 9.09943C40.919 9.51705 41 10.0312 41 10.642V11.0682H35.9545V10.1989H39.9773C39.9773 9.82955 39.9034 9.5 39.7557 9.21023C39.6108 8.92045 39.4034 8.69176 39.1335 8.52415C38.8665 8.35653 38.5511 8.27273 38.1875 8.27273C37.7869 8.27273 37.4403 8.37216 37.1477 8.57102C36.858 8.76705 36.6349 9.02273 36.4787 9.33807C36.3224 9.65341 36.2443 9.99148 36.2443 10.3523V10.9318C36.2443 11.4261 36.3295 11.8452 36.5 12.1889C36.6733 12.5298 36.9134 12.7898 37.2202 12.9688C37.527 13.1449 37.8835 13.233 38.2898 13.233C38.554 13.233 38.7926 13.196 39.0057 13.1222C39.2216 13.0455 39.4077 12.9318 39.5639 12.7812C39.7202 12.6278 39.8409 12.4375 39.9261 12.2102L40.8977 12.483C40.7955 12.8125 40.6236 13.1023 40.3821 13.3523C40.1406 13.5994 39.8423 13.7926 39.4872 13.9318C39.1321 14.0682 38.733 14.1364 38.2898 14.1364ZM47.6829 7.45455L45.2624 14H44.2397L41.8192 7.45455H42.9102L44.717 12.6705H44.7852L46.592 7.45455H47.6829ZM52.3853 14V7.45455H53.3569V8.47727H53.4421C53.5785 8.12784 53.7987 7.85653 54.1026 7.66335C54.4066 7.46733 54.7717 7.36932 55.1978 7.36932C55.6296 7.36932 55.989 7.46733 56.2759 7.66335C56.5657 7.85653 56.7915 8.12784 56.9535 8.47727H57.0217C57.1893 8.1392 57.4407 7.87074 57.7759 7.67188C58.1112 7.47017 58.5131 7.36932 58.9819 7.36932C59.5671 7.36932 60.0458 7.55256 60.418 7.91903C60.7901 8.28267 60.9762 8.84943 60.9762 9.61932V14H59.9705V9.61932C59.9705 9.13636 59.8384 8.79119 59.5742 8.58381C59.31 8.37642 58.9989 8.27273 58.641 8.27273C58.1808 8.27273 57.8242 8.41193 57.5714 8.69034C57.3185 8.96591 57.1921 9.31534 57.1921 9.73864V14H56.1694V9.51705C56.1694 9.14489 56.0487 8.84517 55.8072 8.6179C55.5657 8.38778 55.2546 8.27273 54.8739 8.27273C54.6126 8.27273 54.3683 8.34233 54.141 8.48153C53.9165 8.62074 53.7347 8.81392 53.5955 9.06108C53.4592 9.3054 53.391 9.58807 53.391 9.90909V14H52.3853ZM65.4741 14.1364C64.8832 14.1364 64.3647 13.9957 63.9187 13.7145C63.4755 13.4332 63.1289 13.0398 62.8789 12.5341C62.6317 12.0284 62.5082 11.4375 62.5082 10.7614C62.5082 10.0795 62.6317 9.48437 62.8789 8.97585C63.1289 8.46733 63.4755 8.07244 63.9187 7.79119C64.3647 7.50994 64.8832 7.36932 65.4741 7.36932C66.065 7.36932 66.582 7.50994 67.0252 7.79119C67.4712 8.07244 67.8178 8.46733 68.065 8.97585C68.315 9.48437 68.44 10.0795 68.44 10.7614C68.44 11.4375 68.315 12.0284 68.065 12.5341C67.8178 13.0398 67.4712 13.4332 67.0252 13.7145C66.582 13.9957 66.065 14.1364 65.4741 14.1364ZM65.4741 13.233C65.9229 13.233 66.2923 13.1179 66.582 12.8878C66.8718 12.6577 67.0863 12.3551 67.2255 11.9801C67.3647 11.6051 67.4343 11.1989 67.4343 10.7614C67.4343 10.3239 67.3647 9.91619 67.2255 9.53835C67.0863 9.16051 66.8718 8.85511 66.582 8.62216C66.2923 8.3892 65.9229 8.27273 65.4741 8.27273C65.0252 8.27273 64.6559 8.3892 64.3661 8.62216C64.0763 8.85511 63.8619 9.16051 63.7227 9.53835C63.5835 9.91619 63.5138 10.3239 63.5138 10.7614C63.5138 11.1989 63.5835 11.6051 63.7227 11.9801C63.8619 12.3551 64.0763 12.6577 64.3661 12.8878C64.6559 13.1179 65.0252 13.233 65.4741 13.233ZM72.4467 14.1364C71.9013 14.1364 71.4197 13.9986 71.0021 13.723C70.5845 13.4446 70.2578 13.0526 70.022 12.5469C69.7862 12.0384 69.6683 11.4375 69.6683 10.7443C69.6683 10.0568 69.7862 9.46023 70.022 8.95455C70.2578 8.44886 70.5859 8.05824 71.0064 7.78267C71.4268 7.5071 71.9126 7.36932 72.4638 7.36932C72.8899 7.36932 73.2266 7.44034 73.4737 7.58239C73.7237 7.72159 73.9141 7.88068 74.0447 8.05966C74.1783 8.2358 74.282 8.38068 74.3558 8.49432H74.4411V5.27273H75.4467V14H74.4751V12.9943H74.3558C74.282 13.1136 74.1768 13.2642 74.0405 13.446C73.9041 13.625 73.7095 13.7855 73.4567 13.9276C73.2038 14.0668 72.8672 14.1364 72.4467 14.1364ZM72.5831 13.233C72.9865 13.233 73.3274 13.1278 73.6058 12.9176C73.8842 12.7045 74.0959 12.4105 74.2408 12.0355C74.3857 11.6577 74.4581 11.2216 74.4581 10.7273C74.4581 10.2386 74.3871 9.81108 74.245 9.4446C74.103 9.07528 73.8928 8.78835 73.6143 8.58381C73.3359 8.37642 72.9922 8.27273 72.5831 8.27273C72.157 8.27273 71.8018 8.3821 71.5178 8.60085C71.2365 8.81676 71.0249 9.1108 70.8828 9.48295C70.7436 9.85227 70.674 10.267 70.674 10.7273C70.674 11.1932 70.745 11.6165 70.8871 11.9972C71.032 12.375 71.245 12.6761 71.5263 12.9006C71.8104 13.1222 72.1626 13.233 72.5831 13.233ZM80.1726 14.1364C79.5419 14.1364 78.9979 13.9972 78.5405 13.7188C78.0859 13.4375 77.7351 13.0455 77.4879 12.5426C77.2436 12.0369 77.1214 11.4489 77.1214 10.7784C77.1214 10.108 77.2436 9.51705 77.4879 9.00568C77.7351 8.49148 78.0788 8.09091 78.5192 7.80398C78.9624 7.5142 79.4794 7.36932 80.0703 7.36932C80.4112 7.36932 80.7479 7.42614 81.0803 7.53977C81.4126 7.65341 81.7152 7.83807 81.9879 8.09375C82.2607 8.34659 82.478 8.68182 82.6399 9.09943C82.8018 9.51705 82.8828 10.0312 82.8828 10.642V11.0682H77.8374V10.1989H81.8601C81.8601 9.82955 81.7862 9.5 81.6385 9.21023C81.4936 8.92045 81.2862 8.69176 81.0163 8.52415C80.7493 8.35653 80.4339 8.27273 80.0703 8.27273C79.6697 8.27273 79.3232 8.37216 79.0305 8.57102C78.7408 8.76705 78.5178 9.02273 78.3615 9.33807C78.2053 9.65341 78.1271 9.99148 78.1271 10.3523V10.9318C78.1271 11.4261 78.2124 11.8452 78.3828 12.1889C78.5561 12.5298 78.7962 12.7898 79.103 12.9688C79.4098 13.1449 79.7663 13.233 80.1726 13.233C80.4368 13.233 80.6754 13.196 80.8885 13.1222C81.1044 13.0455 81.2905 12.9318 81.4467 12.7812C81.603 12.6278 81.7237 12.4375 81.8089 12.2102L82.7805 12.483C82.6783 12.8125 82.5064 13.1023 82.2649 13.3523C82.0234 13.5994 81.7251 13.7926 81.37 13.9318C81.0149 14.0682 80.6158 14.1364 80.1726 14.1364Z" fill="white"/>
          </svg>
        </span>
    </a>

      <div class="top-bar">
        <div class="top-bar_left">
          <div class="framework-and-version">
            <FrameworksDropdown/>
            <!--<VersionsDropdown></VersionsDropdown>-->
          </div>
        </div>

        <AlgoliaSearch
          v-if="isAlgoliaSearch"
          :options="algolia"
        />

        <div class="menu">
          <NavLinks/>
          <ExternalNavLinks/>

          <nav class="icons-nav">
            <span class="news"><i class="ico i-bell"></i></span>
            <ThemeSwitcher />
            <a href="https://github.com/handsontable/handsontable" class="github-stars" target="_blank">
              <i class="ico i-github"></i>
              <span v-if="stars">{{ stars }}</span>
            </a>
            <button class="menuButton" id="mobileSearch" aria-label="Search"><i class="ico i-search"></i></button>
            <button @click="$emit('toggle-sidebar')" class="menuButton" aria-label="Menu button">
              <i class="ico i-menu"></i>
              <i class="ico i-close"></i>
            </button>
          </nav>
        </div>
      </div>

    </div>
  </header>
</template>

<script>
/* global Headway */
import AlgoliaSearch from '@theme/components/AlgoliaSearch.vue';
import Logo from '@theme/components/Logo.vue';
import SidebarButton from '@theme/components/SidebarButton.vue';
import NavLinks from '@theme/components/NavLinks.vue';
// import VersionsDropdown from '@theme/components/VersionsDropdown.vue';
import ThemeSwitcher from '@theme/components/ThemeSwitcher.vue';
import FrameworksDropdown from '@theme/components/FrameworksDropdown.vue';
import ExternalNavLinks from '@theme/components/ExternalNavLinks.vue';
import SidebarLinks from '@theme/components/SidebarLinks.vue';

export default {
  name: 'Navbar',
  components: {
    Logo,
    FrameworksDropdown,
    SidebarButton,
    NavLinks,
    AlgoliaSearch,
    // VersionsDropdown,
    ThemeSwitcher,
    ExternalNavLinks,
    SidebarLinks
  },
  data() {
    return {
      linksWrapMaxWidth: null,
      stars: 0
    };
  },
  computed: {
    algolia() {
      return this.$themeLocaleConfig.algolia || this.$site.themeConfig.algolia || {};
    },
    isAlgoliaSearch() {
      return this.algolia && this.algolia.apiKey && this.algolia.indexName;
    },
    isDev() {
      return this.$page.currentVersion === 'next'
    }
  },
  methods: {
    kFormatter(num) {
      return Math.abs(num) > 999
        ? `${Math.sign(num) * (Math.abs(num) / 1000).toFixed(1)}k`
        : Math.sign(num) * Math.abs(num);
    },
    async getStars() {
      try {
        const response = await fetch(
          'https://api.github.com/repos/handsontable/handsontable'
        );
        const data = await response.json();

        this.stars = this.kFormatter(data?.stargazers_count ?? 0);
      } catch (error) {
        // eslint-disable-next-line no-console
        console.log(error);
      }
    },
    handleSearchClick() {
      const btnAlgolia = document.querySelector('.DocSearch');

      if (btnAlgolia) {
        btnAlgolia.click();
      }
    },
  },
  mounted() {
    // Initialize Headway widget
    const config = {
      selector: '.news',
      account: 'xaD6ry'
    };

    Headway.init(config);
    this.getStars();

    // Add click event to #search
    const searchElement = document.getElementById('mobileSearch');

    if (searchElement) {
      searchElement.addEventListener('click', this.handleSearchClick);
    }
  }
};
</script>
